# ===================================
# BLOCKSCOPE BACKEND CONFIGURATION
# ===================================
# Copy this file to .env.development or .env.production and fill in actual values
# NEVER commit .env files with real credentials!

# ===================================
# APPLICATION SETTINGS
# ===================================
APP_NAME=BlockScope
APP_VERSION=1.0.0
ENVIRONMENT=development  # Options: development, staging, production
DEBUG=True  # Set to False in production
LOG_LEVEL=INFO  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

# ===================================
# SERVER CONFIGURATION
# ===================================
HOST=0.0.0.0
PORT=8000
WORKERS=4  # Number of worker processes (CPU cores * 2 + 1)
RELOAD=True  # Auto-reload on code changes (development only)

# ===================================
# DATABASE CONFIGURATION
# ===================================
# PostgreSQL connection string
# Format: postgresql://username:password@host:port/database
DATABASE_URL=postgresql://blockscope_user:CHANGE_ME_STRONG_PASSWORD@localhost:5432/blockscope_db

# Database pool settings
DB_POOL_SIZE=20  # Maximum number of connections in pool
DB_MAX_OVERFLOW=10  # Maximum overflow connections
DB_POOL_TIMEOUT=30  # Seconds to wait for connection
DB_POOL_RECYCLE=3600  # Recycle connections after 1 hour
DB_ECHO=False  # Log all SQL statements (set True for debugging)

# ===================================
# REDIS CONFIGURATION
# ===================================
# Redis connection string for caching and rate limiting
# Format: redis://username:password@host:port/database
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=  # Leave empty if no password
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# ===================================
# SECURITY & AUTHENTICATION
# ===================================
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(64))"
SECRET_KEY=CHANGE_ME_GENERATE_RANDOM_64_CHAR_SECRET_KEY_HERE
JWT_SECRET_KEY=CHANGE_ME_GENERATE_RANDOM_64_CHAR_JWT_SECRET_KEY_HERE
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60  # 1 hour
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30  # 30 days

# API Key Configuration
API_KEY_HEADER_NAME=X-API-Key
API_KEY_LENGTH=32  # Length of generated API keys
API_KEY_PREFIX=bsc_  # Prefix for API keys (BlockScope)

# Password hashing
BCRYPT_ROUNDS=12  # Higher = more secure but slower

# ===================================
# CORS CONFIGURATION
# ===================================
# Comma-separated list of allowed origins
CORS_ORIGINS=http://localhost:5173,http://localhost:3000,http://127.0.0.1:5173
CORS_ALLOW_CREDENTIALS=True
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=*
CORS_MAX_AGE=3600

# ===================================
# RATE LIMITING
# ===================================
# Rate limit configuration
RATE_LIMIT_ENABLED=True
RATE_LIMIT_PER_MINUTE=20  # Requests per minute per IP
RATE_LIMIT_PER_HOUR=100  # Requests per hour per IP
RATE_LIMIT_PER_DAY=1000  # Requests per day per IP

# API Key tier limits (authenticated users)
API_KEY_RATE_LIMIT_PER_MINUTE=60
API_KEY_RATE_LIMIT_PER_HOUR=500
API_KEY_RATE_LIMIT_PER_DAY=5000

# Burst allowance
RATE_LIMIT_BURST=10  # Allow burst of requests

# ===================================
# FILE UPLOAD CONFIGURATION
# ===================================
MAX_UPLOAD_SIZE=5242880  # 5MB in bytes (5 * 1024 * 1024)
ALLOWED_EXTENSIONS=.sol  # Comma-separated: .sol,.vy
UPLOAD_FOLDER=/tmp/blockscope_uploads
MAX_FILENAME_LENGTH=255

# ===================================
# SLITHER CONFIGURATION
# ===================================
SLITHER_TIMEOUT=300  # 5 minutes timeout for analysis
SLITHER_MAX_CONCURRENT=3  # Maximum concurrent analyses
SLITHER_PATH=/usr/local/bin/slither  # Path to Slither binary
SOLC_VERSION=0.8.20  # Default Solidity compiler version

# ===================================
# ANALYSIS CONFIGURATION
# ===================================
# Security score calculation weights
CRITICAL_WEIGHT=100
HIGH_WEIGHT=50
MEDIUM_WEIGHT=20
LOW_WEIGHT=5

# Analysis result caching
CACHE_SCAN_RESULTS=True
CACHE_TTL=86400  # 24 hours in seconds
CACHE_PREFIX=scan:

# ===================================
# EMAIL CONFIGURATION (Optional)
# ===================================
SMTP_ENABLED=False
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM_EMAIL=noreply@blockscope.io
SMTP_FROM_NAME=BlockScope Security Scanner
SMTP_TLS=True
SMTP_SSL=False

# ===================================
# MONITORING & LOGGING
# ===================================
# Sentry for error tracking (optional)
SENTRY_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_ENVIRONMENT=development

# Log file configuration
LOG_FILE_ENABLED=True
LOG_FILE_PATH=/var/log/blockscope/app.log
LOG_FILE_MAX_BYTES=10485760  # 10MB
LOG_FILE_BACKUP_COUNT=5
LOG_JSON_FORMAT=True  # JSON structured logs

# Request logging
LOG_REQUESTS=True
LOG_RESPONSES=False  # Can be verbose
LOG_REQUEST_BODY=False  # Security: Don't log sensitive data

# ===================================
# PERFORMANCE & OPTIMIZATION
# ===================================
# Response compression
GZIP_MINIMUM_SIZE=1000  # Minimum response size to compress (bytes)
GZIP_COMPRESSION_LEVEL=6  # 1-9, higher = more compression

# Query optimization
DB_STATEMENT_TIMEOUT=30000  # 30 seconds max for queries (milliseconds)

# ===================================
# BACKGROUND TASKS (Celery - Optional)
# ===================================
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2
CELERY_TASK_TRACK_STARTED=True
CELERY_TASK_TIME_LIMIT=600  # 10 minutes
CELERY_TASK_SOFT_TIME_LIMIT=540  # 9 minutes

# ===================================
# FEATURE FLAGS
# ===================================
ENABLE_REGISTRATION=True
ENABLE_SOCIAL_LOGIN=False
ENABLE_EMAIL_VERIFICATION=False
ENABLE_TWO_FACTOR_AUTH=False
ENABLE_API_DOCS=True  # Swagger/ReDoc endpoints
ENABLE_METRICS=True  # Prometheus metrics endpoint

# ===================================
# ADMIN CONFIGURATION
# ===================================
ADMIN_EMAIL=admin@blockscope.io
ADMIN_USERNAME=admin
ADMIN_PASSWORD=CHANGE_ME_ON_FIRST_LOGIN

# ===================================
# EXTERNAL SERVICES (Optional)
# ===================================
# Blockchain RPC endpoints (for on-chain contract verification)
ETH_RPC_URL=https://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY
POLYGON_RPC_URL=https://polygon-mainnet.g.alchemy.com/v2/YOUR_API_KEY
BSC_RPC_URL=https://bsc-dataseed.binance.org/

# Analytics (optional)
GOOGLE_ANALYTICS_ID=
MIXPANEL_TOKEN=

# ===================================
# DEVELOPMENT TOOLS
# ===================================
# Automatically reload on code changes
AUTO_RELOAD=True

# Profiling
ENABLE_PROFILER=False
PROFILER_OUTPUT_DIR=/tmp/blockscope_profiles

# ===================================
# TESTING
# ===================================
TESTING=False  # Set to True when running tests
TEST_DATABASE_URL=postgresql://test_user:test_pass@localhost:5432/blockscope_test
